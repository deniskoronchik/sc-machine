language: cpp

git:
  depth: 10

# sudo:required is needed for trusty images
sudo: required
dist: trusty

# https://blog.travis-ci.com/2017-12-12-new-trusty-images-q4-launch
# group: deprecated-2017Q4

notifications:
  email: false

branches:
  only:
    - master
    - dev

stages:
  - test

env:
  global:
    - JOBS=4

jobs:

  # We override the compiler names here to yield better ccache behavior, which uses this as key
  include:

    - &linux-test
      name: Tests / Linux / gcc6 / Debug
      stage: test
      os: linux
      language: cpp
      compiler: "gcc-6-debug"
      addons: &gcc6
        apt:
          sources: ['ubuntu-toolchain-r-test']
          packages: [
            'python3-pip', 
            'g++-6',
            'librocksdb-dev',
            'libglib2.0-dev',
            'libboost-system-dev',
            'libboost-filesystem-dev',
            'libboost-program-options-dev',
            'libboost-regex-dev',
            'libboost-python-dev',
            'python3-dev',
            'python3',
            'make',
            'cmake',
            'antlr',
            'llvm',
            'libcurl4-openssl-dev',
            'libclang-dev',
            'ccache']
      env: CCOMPILER='gcc-6' CXXCOMPILER='g++-6' BUILD_TYPE='Debug'

      install: scripts/travis/install-tests.sh
      script: scripts/travis/run-tests.sh

    - <<: *linux-test
      name: Tests / Linux / gcc6 / Release
      compiler: "gcc-6-release"
      env: CCOMPILER='gcc-6' CXXCOMPILER='g++-6' BUILD_TYPE='Release'
    